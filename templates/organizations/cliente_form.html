{% extends 'base.html' %}

{% block title %}{% if cliente %}Editar{% else %}Novo{% endif %} Cliente - PanDia{% endblock %}
{% block page_title %}{% if cliente %}Editar{% else %}Novo{% endif %} Cliente{% endblock %}

{% block content %}
<div style="max-width: 700px; margin: 0 auto;">
    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 2rem;">
        <div
            style="width: 48px; height: 48px; background: linear-gradient(135deg, #3b82f6, #2563eb); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
            <svg width="24" height="24" fill="none" stroke="white" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
        </div>
        <div>
            <h1 class="content-title" style="margin: 0;">{% if cliente %}Editar Cliente{% else %}Novo Cliente{% endif %}
            </h1>
            <p class="content-subtitle" style="margin: 0.25rem 0 0 0;">{% if cliente %}Atualize as informações do
                cliente{% else %}Cadastre um novo cliente para receber promoções{% endif %}</p>
        </div>
    </div>

    <form method="post" class="card">
        {% csrf_token %}

        <div style="margin-bottom: 1.5rem;">
            <h3
                style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem; color: var(--gray-900); display: flex; align-items: center; gap: 0.5rem;">
                <svg width="20" height="20" fill="none" stroke="#3b82f6" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
                Dados do Cliente
            </h3>

            <div class="form-group">
                <label class="form-label" for="nome">Nome Completo *</label>
                <input type="text" name="nome" id="nome" class="form-input" required
                    value="{{ cliente.nome|default:'' }}" placeholder="Ex: João da Silva">
            </div>

            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem;">
                <div class="form-group">
                    <label class="form-label" for="telefone">Telefone/WhatsApp *</label>
                    <input type="tel" name="telefone" id="telefone" class="form-input" required
                        value="{{ cliente.telefone|default:'' }}" placeholder="(00) 00000-0000" maxlength="20">
                    <p style="font-size: 0.75rem; color: var(--gray-500); margin-top: 0.25rem;">
                        Número com DDD para envio de promoções
                    </p>
                </div>

                <div class="form-group">
                    <label class="form-label" for="email">E-mail (opcional)</label>
                    <input type="email" name="email" id="email" class="form-input"
                        value="{{ cliente.email|default:'' }}" placeholder="cliente@email.com">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="observacoes">Observações (opcional)</label>
                <textarea name="observacoes" id="observacoes" class="form-input" rows="2"
                    placeholder="Anotações sobre o cliente, preferências, etc.">{{ cliente.observacoes|default:'' }}</textarea>
            </div>
        </div>

        <div style="background: var(--gray-50); padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
            <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem; color: var(--gray-900);">
                Preferências
            </h3>

            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                <label style="display: flex; align-items: center; gap: 0.75rem; cursor: pointer;">
                    <input type="checkbox" name="aceita_promocoes" {% if cliente.aceita_promocoes or not cliente
                        %}checked{% endif %} style="width: 18px; height: 18px; accent-color: #3b82f6;">
                    <div>
                        <span style="font-weight: 500; color: var(--gray-900);">Aceita receber promoções</span>
                        <p style="margin: 0; font-size: 0.75rem; color: var(--gray-500);">
                            Cliente autoriza receber mensagens promocionais via WhatsApp
                        </p>
                    </div>
                </label>

                {% if cliente %}
                <label style="display: flex; align-items: center; gap: 0.75rem; cursor: pointer;">
                    <input type="checkbox" name="is_active" {% if cliente.is_active %}checked{% endif %}
                        style="width: 18px; height: 18px; accent-color: #3b82f6;">
                    <div>
                        <span style="font-weight: 500; color: var(--gray-900);">Cliente ativo</span>
                        <p style="margin: 0; font-size: 0.75rem; color: var(--gray-500);">
                            Desmarque para desativar este cliente
                        </p>
                    </div>
                </label>
                {% endif %}
            </div>
        </div>

        <div
            style="display: flex; justify-content: flex-end; gap: 1rem; padding-top: 1rem; border-top: 1px solid var(--gray-100);">
            <a href="{% url 'organizations:cliente_list' %}" class="btn btn-secondary">Cancelar</a>
            <button type="submit" class="btn btn-primary">
                <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"
                    style="margin-right: 0.5rem;">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                </svg>
                {% if cliente %}Salvar Alterações{% else %}Cadastrar Cliente{% endif %}
            </button>
        </div>
    </form>
</div>

<script>
    // Máscara para telefone
    document.getElementById('telefone').addEventListener('input', function (e)
    {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length <= 11)
        {
            value = value.replace(/^(\d{2})(\d)/, '($1) $2');
            value = value.replace(/(\d{5})(\d)/, '$1-$2');
            e.target.value = value;
        }
    });
</script>
{% endblock %}